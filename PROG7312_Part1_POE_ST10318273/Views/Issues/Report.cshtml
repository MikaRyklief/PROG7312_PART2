@{
    ViewData["Title"] = "Report Issue";
    var categories = (string[])ViewData["Categories"];         
    var recentMessages = ViewData["RecentMessages"] as Queue<string>; 
    var submittedCount = (int)ViewData["SubmittedCount"];        
}

@using (Html.BeginForm("Report", "Issues", FormMethod.Post, new { enctype = "multipart/form-data" }))
{
    @Html.AntiForgeryToken()
    
    <div class="container mt-4">
        <h2>Report an Issue</h2>

        @if (TempData["Success"] != null)
        {
            <div class="alert alert-success">@TempData["Success"]</div>
        }
      
        @if (TempData["Error"] != null)
        {
            <div class="alert alert-danger">@TempData["Error"]</div>
        }

        <div class="mb-3">
            <label>Reporter Name</label>
            <input name="ReporterName" class="form-control" />
        </div>

        <div class="mb-3">
            <label>Location</label>
            <input name="Location" class="form-control" required />
        </div>

        <div class="mb-3">
            <label>Category</label>
            <select name="Category" class="form-select">
                @foreach (var c in categories)
                {
                    <option>@c</option>
                }
            </select>
        </div>

        <div class="mb-3">
            <label>Description</label>
            <textarea name="Description" class="form-control" rows="5" required></textarea>
        </div>

        <div class="mb-3">
            <label>Attach Image / Document</label>
            <input type="file" name="file" class="form-control" />
        </div>

        <button type="submit" class="btn btn-primary">Submit</button>
        <a href="/" class="btn btn-secondary ms-2">Back to Main Menu</a>

        <hr />

        <h5>Engagement</h5>
        <p>Reports submitted so far: <strong>@submittedCount</strong></p>

        <div class="progress" style="height:20px;">
            @{
                var progress = Math.Min(100, submittedCount);
            }
            <div class="progress-bar" role="progressbar" style="width:@progress%">@progress%</div>
        </div>

        <div class="mt-3">
            <h6>Recent encouragements</h6>
            <ul>
                @if (recentMessages != null)
                {
                    foreach (var m in recentMessages)
                    {
                        <li>@m</li>
                    }
                }
                else
                {
                    <li>Be the change — report issues in your area!</li>
                }
            </ul>
        </div>
    </div>
}
